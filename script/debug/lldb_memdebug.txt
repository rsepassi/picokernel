# LLDB script for x64 memory debugging
# Connect to QEMU GDB stub
gdb-remote localhost:1234

# Set breakpoints at key initialization points
breakpoint set --name _start
breakpoint set --name kmain
breakpoint set --name platform_init
breakpoint set --name mem_print_map
breakpoint set --name mem_validate_critical_regions
breakpoint set --name mem_dump_page_tables

# Set command to execute when hitting platform_init
breakpoint command add 2
register read rip rsp rbp rax
x/8gx 0x100000
continue
DONE

# Set command to execute when hitting mem_print_map
breakpoint command add 3
frame info
register read
continue
DONE

# Set command to execute when hitting mem_validate_critical_regions
breakpoint command add 4
# Examine critical memory regions
x/4gx 0x100000
x/4gx 0x101000
x/4gx 0x102000
x/4gx 0x103000
x/4gx 0x104000
x/32gx 0x20D000
continue
DONE

# Set command to execute when hitting mem_dump_page_tables
breakpoint command add 5
# Dump all page table levels
x/8gx 0x100000
x/8gx 0x101000
x/8gx 0x102000
x/8gx 0x103000
x/16gx 0x104000
continue
DONE

# Continue to start execution
continue
